<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barometro de vivienda - Spain Housing</title>
  <meta name="robots" content="follow, index" />
  <meta name="lightning" content="lnurlp:galetaire@getalby.com"/>
  <!-- Schema.org Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Spain Housing Observatory",
    "url": "https://spainhousing.eu/"
  }
  </script>
  <!-- Favicon -->
  <link rel="icon" href="public/favicon.ico" type="image/x-icon">
  <!-- Calls -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.1.2/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link href="../styles/style.css" rel="stylesheet" type="text/css">
  <script>
    function setLanguage(lang) {
      const currentPath = window.location.pathname;
      if (lang === 'es') {
        // Only redirect if not already in Spanish version
        if (!currentPath.includes('/es/')) {
          window.location.href = "/es/barometer.html";
        }
      } else {
        // Only redirect if not already in English version
        if (currentPath.includes('/es/')) {
          window.location.href = "/barometer.html";
        }
      }
    }
  </script>
</head>
<body>
<br>
<br>

<div class="lang-switcher">
  <button onclick="setLanguage('en')">EN</button>
  <button onclick="setLanguage('es')">ES</button>
</div>

<h1>Bar√≥metro de la vivienda üåá</h1>

<div class="navbar">
  <button onclick="window.location.href='index.html'">Indicadores estad√≠sticos üìâ</button>
  <button onclick="window.location.href='barometer.html'">Bar√≥metro de la vivienda üåá</button>
  <button onclick="window.location.href='metodologia.html'">Metodolog√≠a üìì</button>
</div>

<p>Una visi√≥n r√°pida del estado general del mercado de la vivienda, con todos los valores entre 0 y 100 puntos. Debe interpretarse como informativa, no como una medida cient√≠fica.</p>

<h2>√çndice compuesto:</h2>

<div class="gauge-container">
  <div class="gauge-wrapper">
    <h3>√çndice de presi√≥n en la vivienda</h3>
    <svg id="gauge1"></svg>
  </div>
  </div>

  <p>Si el valor es 100, todos los componentes est√°n bajo una presi√≥n muy alta; si el valor es 0, todos los componentes est√°n bajo una presi√≥n muy baja, con un espectro intermedio.</p>

  <p>Para generar el √≠ndice, se han considerado como componentes las siguientes variables: precio, hipotecas, compraventas, salarios, parque de viviendas, m√°rgenes de beneficio y desempleo.</p>

  <p><b>üßÆ Cierre hist√≥rico por a√±o:</b></p>

  <div id="chart-wrapper"><canvas id="averagebarometer"></canvas></div>
  <script src="data/averagebarometer.js"></script>
  <p style="font-size: 14px; font-style: italic;">M√°s sobre el √≠ndice: <a href="posts/baronotes.html">Metodolog√≠a y notas</a>.</p>

  <h2>Componentes individuales:</h2>

  <p>Esta secci√≥n presenta cada componente de forma individual. El promedio de estos componentes conforma el valor del <i>√çndice compuesto</i>. Todos los componentes han sido normalizados (Min‚ÄìMax), con algunas adaptaciones para ciertas variables, se puede consultar una explicaci√≥n m√°s detallada en <a href="posts/baronotes.html">notas metodol√≥gicas</a>.</p>

<div class="gauge-container">
  <div class="gauge-wrapper">
    <h3>Firma de hipotecas</h3>
    <svg id="gauge2"></svg>
  </div>

  <div class="gauge-wrapper">
    <h3>Ritmo de compraventas</h3>
    <svg id="gauge3"></svg>
  </div>

  <div class="column-container" style="font-size: 16px;">
    <p>Las <b>hipotecas</b> muestran el n√∫mero de firmas en relaci√≥n con los l√≠mites demogr√°ficos, donde 100 indica exceso y 0 indica m√≠nimo.</p>
    <p>Las <b>compraventas</b> muestran el n√∫mero de compras y ventas en relaci√≥n con los l√≠mites demogr√°ficos, donde 100 indica exceso y 0 indica m√≠nimo.</p>
  </div>

  <div class="gauge-wrapper">
    <h3>Esfuerzo salarial</h3>
    <svg id="gauge4"></svg>
  </div>

  <div class="gauge-wrapper">
    <h3>Riesgo de desempleo</h3>
    <svg id="gauge7"></svg>
  </div>

  <div class="column-container" style="font-size: 16px;">
    <p>El <b>esfuerzo</b> muestra si los salarios est√°n m√°s lejos de los precios de la vivienda (100) o m√°s cerca (0), bas√°ndose en datos hist√≥ricos entre ambos.</p>
    <p>La <b>escasez de vivienda</b> muestra si estamos m√°s cerca de un d√©ficit hist√≥rico (100) o de un super√°vit (0), bas√°ndose en datos de los √∫ltimos 30 a√±os.</p>
  </div>

  <div class="gauge-wrapper">
    <h3>M√°rgenes de beneficio</h3>
    <svg id="gauge6"></svg>
  </div>

  <div class="gauge-wrapper">
    <h3>Escasez de vivienda</h3>
    <svg id="gauge5"></svg>
  </div>

  <div class="column-container" style="font-size: 16px;">
    <p>Los <b>m√°rgenes de beneficio</b> muestran si el sector de la construcci√≥n est√° operando en un entorno de ganancias con un margen alto (100) o bajo (0).</p>
    <p>El <b>riesgo de desempleo</b> indica si la tasa de desempleo amenaza con subir (100) o si se mueve consistentemente a la baja (0).</p>
  </div>

  <div class="gauge-wrapper">
    <h3>Presi√≥n en los precios</h3>
    <svg id="gauge8"></svg>
  </div>

  <div class="gauge-wrapper">
    <h3>Presi√≥n en el alquiler</h3>
    <svg id="gauge9"></svg>
  </div>
</div>

<div class="column-container" style="font-size: 16px;">
    <p>El <b>precio</b> muestra si est√° m√°s cerca de un m√°ximo hist√≥rico (100) o de un m√≠nimo hist√≥rico (0), bas√°ndose en datos de los √∫ltimos 15 a√±os.</p>
    <p><strong style="color: rgba(0, 0, 0);">[No es parte del √≠ndice]</strong> El <b>alquiler</b> mide los desequilibrios entre oferta y demanda en los precios. Elaborado por <a href="https://observatoriodelalquiler.org/barometro-del-alquiler/">Observatorio del Alquiler</a>.</p>
</div>

<p><b>üßÆ Cierre hist√≥rico por a√±o:</b></p>

<div id="chart-wrapper"><canvas id="barcomponents"></canvas></div>
<script src="data/barcomponents.js"></script>


<script src="data/barometer.js"></script>
<script>
  // 1. Define the STATIC configurations for each gauge.
  // We've added a "dataColumn" property to map each gauge to a CSV column.
  const gaugeConfigurations = [
    {
      id: 'gauge1', title: 'Average Risk', dataColumn: 'Average_risk',
      segments: [ { value: 15, color: '#1492FF', label: 'Muy baja' },{ value: 15, color: '#69B7FF', label: 'Baja' }, { value: 15, color: '#B8DAFF', label: 'Moderadamente baja' }, { value: 10, color: '#DBDBDB', label: 'Neutral' },{ value: 15, color: '#FFD1C7', label: 'Moderadamente alta' }, { value: 15, color: '#FC6642', label: 'Alta'}, { value: 15, color: '#FF3300', label: 'Muy alta'}, ]
    },
    {
      id: 'gauge2', title: 'Mortgage Risk', dataColumn: 'Mortgage_risk',
      segments: [ { value: 15, color: '#1492FF', label: 'Muy baja' },{ value: 15, color: '#69B7FF', label: 'Baja' }, { value: 15, color: '#B8DAFF', label: 'Moderadamente baja' }, { value: 10, color: '#DBDBDB', label: 'Neutral' },{ value: 15, color: '#FFD1C7', label: 'Moderadamente alta' }, { value: 15, color: '#FC6642', label: 'Alta'}, { value: 15, color: '#FF3300', label: 'Muy alta'}, ]
    },
    {
      id: 'gauge3', title: 'Sales Risk', dataColumn: 'Sales_risk',
      segments: [ { value: 15, color: '#1492FF', label: 'Muy baja' },{ value: 15, color: '#69B7FF', label: 'Baja' }, { value: 15, color: '#B8DAFF', label: 'Moderadamente baja' }, { value: 10, color: '#DBDBDB', label: 'Neutral' },{ value: 15, color: '#FFD1C7', label: 'Moderadamente alta' }, { value: 15, color: '#FC6642', label: 'Alta'}, { value: 15, color: '#FF3300', label: 'Muy alta'}, ]
    },
    {
      id: 'gauge4', title: 'Wage Risk', dataColumn: 'Wage_risk',
      segments: [ { value: 15, color: '#1492FF', label: 'Muy baja' },{ value: 15, color: '#69B7FF', label: 'Baja' }, { value: 15, color: '#B8DAFF', label: 'Moderadamente baja' }, { value: 10, color: '#DBDBDB', label: 'Neutral' },{ value: 15, color: '#FFD1C7', label: 'Moderadamente alta' }, { value: 15, color: '#FC6642', label: 'Alta'}, { value: 15, color: '#FF3300', label: 'Muy alta'}, ]
    },
    {
      id: 'gauge5', title: 'Scarcity Risk', dataColumn: 'Scarcity_risk',
      segments: [ { value: 15, color: '#1492FF', label: 'Muy baja' },{ value: 15, color: '#69B7FF', label: 'Baja' }, { value: 15, color: '#B8DAFF', label: 'Moderadamente baja' }, { value: 10, color: '#DBDBDB', label: 'Neutral' },{ value: 15, color: '#FFD1C7', label: 'Moderadamente alta' }, { value: 15, color: '#FC6642', label: 'Alta'}, { value: 15, color: '#FF3300', label: 'Muy alta'}, ]
    },
    {
      id: 'gauge6', title: 'Production Risk', dataColumn: 'Production_risk',
      segments: [ { value: 15, color: '#1492FF', label: 'Muy baja' },{ value: 15, color: '#69B7FF', label: 'Baja' }, { value: 15, color: '#B8DAFF', label: 'Moderadamente baja' }, { value: 10, color: '#DBDBDB', label: 'Neutral' },{ value: 15, color: '#FFD1C7', label: 'Moderadamente alta' }, { value: 15, color: '#FC6642', label: 'Alta'}, { value: 15, color: '#FF3300', label: 'Muy alta'}, ]
    },
    {
      id: 'gauge7', title: 'Labor Risk', dataColumn: 'Labor_risk',
      segments: [ { value: 15, color: '#1492FF', label: 'Muy baja' },{ value: 15, color: '#69B7FF', label: 'Baja' }, { value: 15, color: '#B8DAFF', label: 'Moderadamente baja' }, { value: 10, color: '#DBDBDB', label: 'Neutral' },{ value: 15, color: '#FFD1C7', label: 'Moderadamente alta' }, { value: 15, color: '#FC6642', label: 'Alta'}, { value: 15, color: '#FF3300', label: 'Muy alta'}, ]
    },
    {
      id: 'gauge8', title: 'Price Risk', dataColumn: 'Price_risk',
      segments: [ { value: 15, color: '#1492FF', label: 'Muy baja' },{ value: 15, color: '#69B7FF', label: 'Baja' }, { value: 15, color: '#B8DAFF', label: 'Moderadamente baja' }, { value: 10, color: '#DBDBDB', label: 'Neutral' },{ value: 15, color: '#FFD1C7', label: 'Moderadamente alta' }, { value: 15, color: '#FC6642', label: 'Alta'}, { value: 15, color: '#FF3300', label: 'Muy alta'}, ]
    },
    {
      id: 'gauge9', title: 'Rent risk', dataColumn: 'Rent_risk',
      segments: [ { value: 15, color: '#1492FF', label: 'Muy baja' },{ value: 15, color: '#69B7FF', label: 'Baja' }, { value: 15, color: '#B8DAFF', label: 'Moderadamente baja' }, { value: 10, color: '#DBDBDB', label: 'Neutral' },{ value: 15, color: '#FFD1C7', label: 'Moderadamente alta' }, { value: 15, color: '#FC6642', label: 'Alta'}, { value: 15, color: '#FF3300', label: 'Muy alta'}, ]
    }
  ];

  // 2. Load the time-series data from your new CSV file
  d3.csv("https://raw.githubusercontent.com/galetaire/spahousing/main/public/docs/spain_stats_csv.csv").then(function(data) {

    // --- MODIFIED LOGIC ---
        // 1. Get the current year.
        const targetYear = new Date().getFullYear(); // This will be 2025

        // 2. Find the row in your data that matches the target year.
        // We use `==` because the year from the CSV is a string, and `getFullYear()` is a number.
        let yearData = data.find(row => row.Year == targetYear);

        // 3. Fallback: If the current year is not found, use the latest available data.
        if (!yearData) {
          console.warn(`Data for year ${targetYear} not found. Using latest available year.`);
          yearData = data[data.length - 1];
        }
        // --- END OF MODIFIED LOGIC ---

        // Loop through your STATIC configurations to build the gauges
        gaugeConfigurations.forEach(config => {
          const column = config.dataColumn;

          // Get the value from the found year's data using the column name.
          const dynamicValue = yearData[column] ? +yearData[column] : 0;

          // Create the gauge with the correct value
          createGauge('#' + config.id, dynamicValue, config.segments);
        });

      }).catch(function(error) {
        console.error("Error loading the CSV file:", error);
      });
</script>
<br>
<!-- Footer-->
<div id="footer">
  <script>document.write(new Date().getFullYear())</script> ¬©HousingSpanish üî≠. Creative Commons Attribution-ShareAlike 4.0 International License.
</div>
<br>
</body>
</html>
