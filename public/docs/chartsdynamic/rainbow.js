// Note: changes to the plugin code is not reflected to the chart, because the plugin is loaded at chart construction time and editor changes only trigger an chart.update().
const plugin = {
  id: 'customCanvasBackgroundColor',
  beforeDraw: (chart, args, options) => {
    const {ctx} = chart;
    ctx.save();
    ctx.globalCompositeOperation = 'destination-over';
    ctx.fillStyle = options.color || '#99ffff';
    ctx.fillRect(0, 0, chart.width, chart.height);
    ctx.restore();
  }
};

//data
const data = {
  labels: ['1964', '1965', '1966', '1967', '1968', '1969', '1970', '1971', '1972', '1973', '1974', '1975', '1976', '1977', '1978', '1979', '1980', '1981', '1982', '1983', '1984', '1985', '1986', '1987', '1988', '1989', '1990', '1991', '1992', '1993', '1994', '1995', '1996', '1997', '1998', '1999', '2000', '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024', '2025', '2026', '2027', '2028', '2029', '2030', '2031', '2032', '2033', '2034', '2035'],
  datasets: [
    {
      label: 'Real price',
      type: 'line',
      data: [112.7, 129.4, 148.3, 159.9, 201.1, 213.5, 233.4, 240.6, 273.5, 313.1, 321.0, 330.9, 322.6, 314.6, 289.8, 273.3, 259.5, 210.1, 210.5, 203.7, 182.5, 186.0, 204.5, 252.3, 328.6, 393.2, 424.7, 399.8, 360.0, 330.7, 320.3, 314.1, 302.5, 308.3, 324.5, 365.8, 421.0, 469.3, 554.6, 676.9, 824.5, 950.6, 1057.1, 1098.1, 1001.7, 932.6, 872.7, 699.5, 492.0, 360.4, 365.3, 396.7, 431.3, 466.4, 477.9, 498.9, 489.4, 532.6, 505.8],
      backgroundColor: 'rgba(38, 38, 38, 0.9)',
      borderColor: 'rgba(38, 38, 38, 0.3)',
      borderWidth: 0.1,
      borderDash: [0,1],
      pointStyle: 'circle',
      pointRadius: 3,
      fill: false
    },
    {
      label: 'Strong overprice',
      type: 'line',
      data: [248.4, 256.8, 265.0, 273.0, 281.0, 288.8, 296.6, 304.2, 311.6, 319.0, 326.2, 333.4, 340.4, 347.2, 354.0, 360.6, 367.2, 373.6, 379.8, 386.0, 392.0, 398.0, 403.8, 409.4, 415.0, 420.4, 425.8, 431.0, 436.0, 441.0, 445.8, 450.6, 455.2, 459.6, 464.0, 468.2, 472.4, 476.4, 480.2, 484.0, 487.6, 491.2, 494.6, 497.8, 501.0, 504.0, 507.0, 509.8, 512.4, 515.0, 517.4, 519.8, 522.0, 524.0, 526.0, 527.8, 529.6, 531.2, 532.6, 534.0, 535.2, 536.4, 537.4, 538.2, 539.0, 539.6, 540.2, 540.6, 540.8, 541.0, 541.0, 541.0, 540.8, 540.4, 540.0, 539.4, 538.8, 538.0, 537.0, 536.0, 534.8, 533.6, 532.2, 530.6, 529.0, 527.2, 525.4, 523.4, 521.2, 519.0, 516.6, 514.2, 511.6, 508.8, 506.0, 503.0, 500.0, 496.8, 493.4, 490.0, 486.4, 482.8,479.0,475.0,471.0,466.8,462.6],
      backgroundColor: 'rgba(255, 0, 0, 0.6)',
      borderColor: 'rgba(255, 0, 0, 0.6)',
      borderWidth: 15,
      pointStyle: 'dash',
      pointRadius: 0,
      fill: false
    },
    {
      label: 'Slight overprice',
      type: 'line',
      data: [198.4, 206.8, 215.0, 223.0, 231.0, 238.8, 246.6, 254.2, 261.6, 269.0, 276.2, 283.4, 290.4, 297.2, 304.0, 310.6, 317.2, 323.6, 329.8, 336.0, 342.0, 348.0, 353.8, 359.4, 365.0, 370.4, 375.8, 381.0, 386.0, 391.0, 395.8, 400.6, 405.2, 409.6, 414.0, 418.2, 422.4, 426.4, 430.2, 434.0, 437.6, 441.2, 444.6, 447.8, 451.0, 454.0, 457.0, 459.8, 462.4, 465.0, 467.4, 469.8, 472.0, 474.0, 476.0, 477.8, 479.6, 481.2, 482.6, 484.0, 485.2, 486.4, 487.4, 488.2, 489.0, 489.6, 490.2, 490.6, 490.8, 491.0, 491.0, 491.0, 490.8, 490.4, 490.0, 489.4, 488.8, 488.0, 487.0, 486.0, 484.8, 483.6, 482.2, 480.6, 479.0, 477.2, 475.4, 473.4, 471.2, 469.0, 466.6, 464.2, 461.6, 458.8, 456.0, 453.0, 450.0, 446.8, 443.4, 440.0, 436.4, 432.8, 429.0, 425.0, 421.0, 416.8, 412.6],
      backgroundColor: 'rgba(255, 102, 0, 0.6)',
      borderColor: 'rgba(255, 102, 0, 0.6)',
      borderWidth: 15,
      pointStyle: 'dash',
      pointRadius: 0,
      fill: false
    },
    {
        label: 'Neutral',
        type: 'line',
        data: [148.4, 156.8, 165.0, 173.0, 181.0, 188.8, 196.6, 204.2, 211.6, 219.0, 226.2, 233.4, 240.4, 247.2, 254.0, 260.6, 267.2, 273.6, 279.8, 286.0, 292.0, 298.0, 303.8, 309.4, 315.0, 320.4, 325.8, 331.0, 336.0, 341.0, 345.8, 350.6, 355.2, 359.6, 364.0, 368.2, 372.4, 376.4, 380.2, 384.0, 387.6, 391.2, 394.6, 397.8, 401.0, 404.0, 407.0, 409.8, 412.4, 415.0, 417.4, 419.8, 422.0, 424.0, 426.0, 427.8, 429.6, 431.2, 432.6, 434.0, 435.2, 436.4, 437.4, 438.2, 439.0, 439.6, 440.2, 440.6, 440.8, 441.0, 441.0, 441.0, 440.8, 440.4, 440.0, 439.4, 438.8, 438.0, 437.0, 436.0, 434.8, 433.6, 432.2, 430.6, 429.0, 427.2, 425.4, 423.4, 421.2, 419.0, 416.6, 414.2, 411.6, 408.8, 406.0, 403.0, 400.0, 396.8, 393.4, 390.0, 386.4, 382.8, 379.0, 375.0, 371.0, 366.8, 362.6],
        backgroundColor: 'rgba(255, 192, 0, 0.6)',
        borderColor: 'rgba(255, 192, 0, 0.6)',
        borderWidth: 15,
        pointStyle: 'dash',
        pointRadius: 0,
        fill: false
    },
    {
      label: 'Slight underprice',
      type: 'line',
      data: [98.4, 106.8, 115.0, 123.0, 131.0, 138.8, 146.6, 154.2, 161.6, 169.0, 176.2, 183.4, 190.4, 197.2, 204.0, 210.6, 217.2, 223.6, 229.8, 236.0, 242.0, 248.0, 253.8, 259.4, 265.0, 270.4, 275.8, 281.0, 286.0, 291.0, 295.8, 300.6, 305.2, 309.6, 314.0, 318.2, 322.4, 326.4, 330.2, 334.0, 337.6, 341.2, 344.6, 347.8, 351.0, 354.0, 357.0, 359.8, 362.4, 365.0, 367.4, 369.8, 372.0, 374.0, 376.0, 377.8, 379.6, 381.2, 382.6, 384.0, 385.2, 386.4, 387.4, 388.2, 389.0, 389.6, 390.2, 390.6, 390.8, 391.0, 391.0, 391.0, 390.8, 390.4, 390.0, 389.4, 388.8, 388.0, 387.0, 386.0, 384.8, 383.6, 382.2, 380.6, 379.0, 377.2, 375.4, 373.4, 371.2, 369.0, 366.6, 364.2, 361.6,358.8,356.0,353.0,350.0,346.8,343.4,340.0,336.4,332.8,329.0,325.0,321.0,316.8,312.6],
      backgroundColor: 'rgba(42, 227, 17, 0.6)',
      borderColor: 'rgba(42, 227, 17, 0.6)',
      borderWidth: 15,
      pointStyle: 'dash',
      pointRadius: 0,
      fill: false
    },
    {
      label: 'Strong underprice',
      type: 'line',
      data: [48.4, 56.8, 65.0, 73.0, 81.0, 88.8, 96.6, 104.2, 111.6, 119.0, 126.2, 133.4, 140.4, 147.2, 154.0, 160.6, 167.2, 173.6, 179.8, 186.0, 192.0, 198.0, 203.8, 209.4, 215.0, 220.4, 225.8, 231.0, 236.0, 241.0, 245.8, 250.6, 255.2, 259.6, 264.0, 268.2, 272.4, 276.4, 280.2, 284.0, 287.6, 291.2, 294.6, 297.8, 301.0, 304.0, 307.0, 309.8, 312.4, 315.0, 317.4, 319.8, 322.0, 324.0, 326.0, 327.8, 329.6, 331.2, 332.6, 334.0, 335.2, 336.4, 337.4, 338.2, 339.0, 339.6, 340.2, 340.6, 340.8, 341.0, 341.0, 341.0, 340.8, 340.4, 340.0, 339.4, 338.8, 338.0, 337.0, 336.0, 334.8, 333.6, 332.2, 330.6, 329.0, 327.2, 325.4, 323.4, 321.2, 319.0, 316.6, 314.2, 311.6, 308.8, 306.0, 303.0, 300.0, 296.8, 293.4, 290.0, 286.4, 282.8, 279.0, 275.0, 271.0, 266.8, 262.6],
      backgroundColor: 'rgba(20, 100, 244, 0.6)',
      borderColor: 'rgba(20, 100, 244, 0.6)',
      borderWidth: 15,
      pointStyle: 'dash',
      pointRadius: 0,
      fill: false
    }]
};

//config
const config = {
  type: 'line',
  data,
  plugins: [plugin],
  options: {
    layout: {
    padding: 5
    },
    title: {
        display: false,
        fontColor: 'rgba(38, 38, 38, 0.8)',
        text: 'Real house value - Spain'
            },
    legend: {
      display: false
    },
    plugins: {
       customCanvasBackgroundColor: {
       color: 'white',
          }
        },
      scales: {
          xAxes: [{
            gridLines: {
              color: 'rgba(30, 30, 30, 0.1)',
            },
              ticks: {
                fontSize: 7,
                fontColor: 'rgba(38, 38, 38, 0.8)',
                autoSkip: false,
                maxRotation: 90,
                minRotation: 90,
                beginAtZero: true
              }
          }],
          yAxes: [{
            scaleLabel: {
              display: true,
              fontSize: 9,
              fontColor: 'rgba(38, 38, 38, 0.8)',
              labelString: 'Housing price in euros (inflation adjusted)'
             },
            gridLines: {
              color: 'rgba(30, 30, 30, 0.1)',
            },
              ticks: {
                  fontSize: 8,
                  fontColor: 'rgba(38, 38, 38, 0.8)',
                  beginAtZero: true
              }
          }],
      },
  },
    plugins: [plugin],
};

//render init block
const rainbow = new Chart(
  document.getElementById('rainbow'),
  config
);
